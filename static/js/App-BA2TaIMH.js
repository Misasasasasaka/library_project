import{p as g,g as p,c as w,q as F,s as H,h as M,x as O,i as j,j as N,d as o,e as c,w as z,r as R,b as e,u as y,B as S,y as u,t as r,f as x,n as m,T as E,z as U,A as G,C as J,o as a,F as K,m as P,a as Q,D as W}from"./index-BL0x7uEM.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=g("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=g("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=g("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),Z={key:0,class:"text-center py-16 text-text-muted"},ee={key:1,class:"text-center py-16 text-text-muted"},te={key:2,class:"bg-white rounded-2xl border border-border p-8"},se={class:"flex gap-10"},ae={class:"w-56 flex-shrink-0"},oe={class:"aspect-[3/4] bg-sidebar rounded-2xl overflow-hidden shadow-sm"},le=["src","alt"],ne={key:1,class:"w-full h-full flex items-center justify-center text-text-light"},re={class:"flex-1"},ie={class:"text-3xl font-semibold text-text-primary"},ue={class:"mt-6 space-y-3 text-text-secondary"},de={key:0},ce={key:1},ve={class:"font-mono"},pe={key:2},ye={key:3},xe={class:"text-text-muted"},me={class:"mt-8"},be={key:0,class:"mb-5"},_e={class:"relative w-56"},fe=["disabled"],he={class:"flex items-center gap-3"},ke={class:"w-8 h-8 bg-claude-50 rounded-lg flex items-center justify-center"},we={class:"text-text-primary font-medium"},ge={key:0,class:"absolute z-20 mt-2 w-full bg-white border border-border rounded-xl shadow-lg overflow-hidden"},Ce={class:"max-h-48 overflow-y-auto py-1"},Be=["onClick"],je={key:2,disabled:"",class:"btn-primary px-8 py-3 text-base opacity-50 cursor-not-allowed"},Ne=["disabled"],ze={key:0,class:"mt-10 pt-8 border-t border-border"},$e={class:"text-text-secondary leading-relaxed"},Te={__name:"App",setup(Ae){const C=H(),A=U(),s=p(null),h=p(!0),b=p(!1),v=p([]),n=p(null),d=p(!1),I=w(()=>F.value),_=w(()=>C.params.id),L=w(()=>{const l=v.value.find(t=>t.copy_no===n.value);return(l==null?void 0:l.code)||""});M(async()=>{await k()}),O(()=>C.params.id,()=>{k()});async function k(){h.value=!0;try{const l=await j(`/api/books/${_.value}`);s.value=l.book,await q()}catch(l){N(l.message||"加载图书失败"),v.value=[],n.value=null}finally{h.value=!1}}function T(){A.push("/login/")}function V(l){n.value=l,d.value=!1}async function D(){if(n.value){b.value=!0;try{await G("/api/borrows",{book_id:parseInt(_.value),copy_no:n.value}),J("借阅成功！"),await k()}catch(l){N(l.message||"借阅失败")}finally{b.value=!1}}}async function q(){var l;if(_.value)try{const f=(await j(`/api/books/${_.value}/available-copies`)).results||[];v.value=f,n.value=((l=f[0])==null?void 0:l.copy_no)??null}catch{v.value=[],n.value=null}}return(l,t)=>{var B;const f=R("router-link");return a(),o("div",null,[c(f,{to:"/books/",class:"inline-flex items-center text-text-muted hover:text-claude-600 mb-6 transition-colors"},{default:z(()=>[c(y(X),{class:"w-5 h-5 mr-2","stroke-width":2}),t[2]||(t[2]=x(" 返回图书列表 ",-1))]),_:1}),h.value?(a(),o("div",Z," 加载中... ")):s.value?(a(),o("div",te,[e("div",se,[e("div",ae,[e("div",oe,[s.value.cover_url?(a(),o("img",{key:0,src:s.value.cover_url,alt:s.value.title,class:"w-full h-full object-cover"},null,8,le)):(a(),o("div",ne,[c(y(S),{class:"w-20 h-20","stroke-width":1})]))])]),e("div",re,[e("h1",ie,r(s.value.title),1),e("div",ue,[e("p",null,[t[3]||(t[3]=e("span",{class:"text-text-muted"},"作者：",-1)),x(r(s.value.author),1)]),s.value.publisher?(a(),o("p",de,[t[4]||(t[4]=e("span",{class:"text-text-muted"},"出版社：",-1)),x(r(s.value.publisher),1)])):u("",!0),s.value.isbn?(a(),o("p",ce,[t[5]||(t[5]=e("span",{class:"text-text-muted"},"ISBN：",-1)),e("span",ve,r(s.value.isbn),1)])):u("",!0),(B=s.value.category)!=null&&B.name?(a(),o("p",pe,[t[6]||(t[6]=e("span",{class:"text-text-muted"},"分类：",-1)),x(r(s.value.category.name),1)])):u("",!0),s.value.location?(a(),o("p",ye,[t[7]||(t[7]=e("span",{class:"text-text-muted"},"位置：",-1)),x(r(s.value.location),1)])):u("",!0),e("p",null,[t[8]||(t[8]=e("span",{class:"text-text-muted"},"库存：",-1)),e("span",{class:m(s.value.available_copies>0?"text-emerald-600 font-medium":"text-red-500")}," 可借 "+r(s.value.available_copies),3),e("span",xe," / 共 "+r(s.value.total_copies)+" 本",1)])]),e("div",me,[s.value.available_copies>0?(a(),o("div",be,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-text-secondary mb-2"},"选择副本",-1)),e("div",_e,[e("button",{type:"button",onClick:t[0]||(t[0]=i=>d.value=!d.value),disabled:v.value.length===0,class:"w-full flex items-center justify-between px-4 py-3 bg-white border border-border rounded-xl text-left transition-all duration-200 hover:border-claude-300 focus:outline-none focus:ring-2 focus:ring-claude-500/20 focus:border-claude-400 disabled:opacity-50 disabled:cursor-not-allowed"},[e("div",he,[e("div",ke,[c(y($),{class:"w-4 h-4 text-claude-500","stroke-width":2})]),e("span",we,r(L.value||"请选择"),1)]),c(y(Y),{class:m(["w-5 h-5 text-text-muted transition-transform duration-200",{"rotate-180":d.value}]),"stroke-width":2},null,8,["class"])],8,fe),c(E,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"opacity-0 translate-y-1","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-1"},{default:z(()=>[d.value?(a(),o("div",ge,[e("div",Ce,[(a(!0),o(K,null,P(v.value,i=>(a(),o("button",{key:i.copy_no,type:"button",onClick:Ie=>V(i.copy_no),class:m(["w-full flex items-center gap-3 px-4 py-2.5 text-left transition-colors hover:bg-claude-50",n.value===i.copy_no?"bg-claude-50":""])},[e("div",{class:m(["w-8 h-8 rounded-lg flex items-center justify-center",n.value===i.copy_no?"bg-claude-500 text-white":"bg-gray-100 text-text-muted"])},[c(y($),{class:"w-4 h-4","stroke-width":2})],2),e("span",{class:m(["font-medium",n.value===i.copy_no?"text-claude-600":"text-text-primary"])},r(i.code),3),n.value===i.copy_no?(a(),Q(y(W),{key:0,class:"w-4 h-4 text-claude-500 ml-auto","stroke-width":2.5})):u("",!0)],10,Be))),128))])])):u("",!0)]),_:1}),d.value?(a(),o("div",{key:0,onClick:t[1]||(t[1]=i=>d.value=!1),class:"fixed inset-0 z-10"})):u("",!0)])])):u("",!0),I.value?s.value.available_copies===0?(a(),o("button",je," 暂无库存 ")):(a(),o("button",{key:3,onClick:D,disabled:b.value||!n.value,class:"btn-primary px-8 py-3 text-base"},r(b.value?"借阅中...":"立即借阅"),9,Ne)):(a(),o("button",{key:1,onClick:T,class:"btn-primary px-8 py-3 text-base"}," 登录后借阅 "))]),s.value.description?(a(),o("div",ze,[t[10]||(t[10]=e("h3",{class:"text-lg font-medium text-text-primary mb-3"},"简介",-1)),e("p",$e,r(s.value.description),1)])):u("",!0)])])])):(a(),o("div",ee," 图书不存在 "))])}}};export{Te as default};
