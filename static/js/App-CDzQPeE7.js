import{E as _,g as u,h as U,i as q,J as M,d as w,b as t,e as v,w as h,r as S,G as B,y as E,k as r,v as i,t as f,f as y,K as I,z as N,o as g,u as P,H as T,M as D}from"./index-BL0x7uEM.js";const R={class:"min-h-screen bg-content flex items-center justify-center p-4"},j={class:"w-full max-w-md"},$={class:"w-16 h-16 bg-claude-500 rounded-2xl flex items-center justify-center mx-auto shadow-lg group-hover:bg-claude-600 transition-colors"},z={class:"bg-white rounded-2xl shadow-sm border border-border p-8"},A={class:"space-y-5"},F={class:"flex items-end gap-3"},G={class:"flex-1"},H=["src"],J={class:"flex items-end gap-3"},K={class:"flex-1"},L=["disabled"],O={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 text-sm rounded-xl"},Q=["disabled"],W={class:"mt-6 text-center text-sm text-text-muted"},Z={__name:"App",setup(X){const C=N(),l=_({username:"",mail:"",captcha:"",emailCode:"",password:"",confirmPassword:""}),p=u(!1),a=u(""),b=u(""),c=u(!1),n=u(0);let o=null;U(async()=>{try{await q("/api/auth/csrf")}catch{console.error("获取 CSRF Token 失败")}m()}),M(()=>{o&&(clearInterval(o),o=null)});function m(){b.value=`/api/auth/captcha?t=${Date.now()}`}async function k(){if(a.value="",!l.mail){a.value="请输入邮箱";return}if(!l.captcha){a.value="请输入图片验证码";return}c.value=!0;try{await I(l.mail,l.captcha),n.value=60,o&&clearInterval(o),o=setInterval(()=>{n.value=Math.max(0,n.value-1),n.value<=0&&o&&(clearInterval(o),o=null)},1e3)}catch(d){a.value=d.message||"验证码发送失败，请稍后重试",l.captcha="",m()}finally{c.value=!1}}async function V(){if(a.value="",l.password!==l.confirmPassword){a.value="两次输入的密码不一致";return}if(l.password.length<6){a.value="密码长度至少为6位";return}p.value=!0;try{await D(l.username,l.password,l.mail,l.emailCode,l.captcha),C.push("/books/")}catch(d){a.value=d.message||"注册失败，请稍后重试",l.captcha="",m()}finally{p.value=!1}}return(d,e)=>{const x=S("router-link");return g(),w("div",R,[t("div",j,[v(x,{to:"/books/",class:"block text-center mb-8 group"},{default:h(()=>[t("div",$,[v(P(T),{class:"w-8 h-8 text-white","stroke-width":2})]),e[6]||(e[6]=t("h1",{class:"mt-6 text-2xl font-semibold text-text-primary group-hover:text-claude-600 transition-colors"},"图书馆",-1)),e[7]||(e[7]=t("p",{class:"mt-2 text-text-muted"},"创建账户，开启阅读之旅",-1))]),_:1}),t("div",z,[t("form",{onSubmit:B(V,["prevent"])},[t("div",A,[t("div",null,[e[8]||(e[8]=t("label",{class:"label"},"用户名",-1)),r(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.username=s),type:"text",required:"",class:"input",placeholder:"请输入用户名"},null,512),[[i,l.username]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"label"},"邮箱",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.mail=s),type:"email",required:"",class:"input",placeholder:"请输入邮箱"},null,512),[[i,l.mail]])]),t("div",F,[t("div",G,[e[10]||(e[10]=t("label",{class:"label"},"验证码",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.captcha=s),type:"text",required:"",class:"input",placeholder:"请输入图片验证码"},null,512),[[i,l.captcha]])]),t("img",{src:b.value,class:"h-11 w-32 rounded-xl border border-border cursor-pointer select-none",alt:"验证码",title:"点击刷新验证码",onClick:m},null,8,H)]),t("div",J,[t("div",K,[e[11]||(e[11]=t("label",{class:"label"},"邮箱验证码",-1)),r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.emailCode=s),type:"text",required:"",class:"input",placeholder:"请输入邮箱验证码"},null,512),[[i,l.emailCode]])]),t("button",{type:"button",class:"btn-secondary h-11 whitespace-nowrap",disabled:c.value||n.value>0,onClick:k},f(n.value>0?`${n.value}s`:c.value?"发送中...":"发送验证码"),9,L)]),t("div",null,[e[12]||(e[12]=t("label",{class:"label"},"密码",-1)),r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.password=s),type:"password",required:"",minlength:"6",class:"input",placeholder:"请输入密码（至少6位）"},null,512),[[i,l.password]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"label"},"确认密码",-1)),r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.confirmPassword=s),type:"password",required:"",class:"input",placeholder:"请再次输入密码"},null,512),[[i,l.confirmPassword]])])]),a.value?(g(),w("div",O,f(a.value),1)):E("",!0),t("button",{type:"submit",disabled:p.value,class:"mt-6 w-full btn-primary py-3 text-base font-medium"},f(p.value?"注册中...":"注册"),9,Q)],32),t("p",W,[e[15]||(e[15]=y(" 已有账户？ ",-1)),v(x,{to:"/login/",class:"text-claude-600 hover:text-claude-700 font-medium"},{default:h(()=>[...e[14]||(e[14]=[y("立即登录",-1)])]),_:1})])])])])}}};export{Z as default};
