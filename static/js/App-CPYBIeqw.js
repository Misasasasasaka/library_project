import{_ as Z,c as E,k as H,o as g,d as c,s as d,a as k,y as B,b as t,t as u,u as P,X as Q,I as D,n as T,T as W,J as Y,r as o,D as ee,f as te,g as le,h as N,x as se,w as n,v as i,i as ae,K as oe,e as S,E as ne,M as I,C as U,A as ie,N as ue}from"./index-BneSkAzL.js";import{_ as de}from"./DataTable-B5qw0pmj.js";import{S as re,_ as pe}from"./Pagination-BWsnICMh.js";const ce={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},me={key:0,class:"flex items-center justify-between px-6 py-5 border-b border-border"},ve={class:"text-lg font-semibold text-text-primary"},be={class:"p-6"},fe={key:1,class:"px-6 py-4 border-t border-border flex justify-end gap-3 bg-sidebar rounded-b-2xl"},xe={__name:"Modal",props:{modelValue:Boolean,title:String,size:{type:String,default:"md",validator:m=>["sm","md","lg","xl"].includes(m)},closable:{type:Boolean,default:!0}},emits:["update:modelValue","close"],setup(m,{emit:M}){const b=m,f=M,x=E(()=>({sm:"w-full max-w-sm",md:"w-full max-w-md",lg:"w-full max-w-lg",xl:"w-full max-w-xl"})[b.size]);function v(){b.closable&&(f("update:modelValue",!1),f("close"))}return(r,z)=>(g(),H(Y,{to:"body"},[c(W,{name:"modal"},{default:d(()=>[m.modelValue?(g(),k("div",ce,[t("div",{class:"absolute inset-0 bg-text-primary/50 backdrop-blur-sm",onClick:v}),t("div",{class:T(["relative bg-white rounded-2xl shadow-xl max-h-[90vh] overflow-auto",x.value])},[m.title?(g(),k("div",me,[t("h3",ve,u(m.title),1),t("button",{onClick:v,class:"text-text-muted hover:text-text-secondary transition-colors"},[c(P(Q),{class:"w-5 h-5","stroke-width":2})])])):B("",!0),t("div",be,[D(r.$slots,"default",{},void 0,!0)]),r.$slots.footer?(g(),k("div",fe,[D(r.$slots,"footer",{},void 0,!0)])):B("",!0)],2)])):B("",!0)]),_:3})]))}},A=Z(xe,[["__scopeId","data-v-fb16896a"]]),ye={class:"flex items-center justify-between mb-8"},ge={class:"flex gap-3"},_e={class:"flex items-center gap-4 mb-6"},he={class:"flex-1 relative"},we={class:"font-mono text-xs bg-sidebar px-2 py-1 rounded"},ke={class:"text-text-secondary"},Ve={class:"text-text-muted"},Ce={class:"flex gap-3"},$e=["onClick"],Se=["onClick"],Ue=["onClick"],Be={class:"mt-8"},Me={class:"grid grid-cols-2 gap-5"},ze={class:"col-span-2"},Ne={key:0,class:"mt-4 p-3 bg-red-50 text-red-600 text-sm rounded-xl"},je={class:"mt-6 flex justify-end gap-3"},De=["disabled"],Ie={class:"text-text-secondary"},Ae=["disabled"],Ee=20,qe={__name:"App",setup(m){const M=[{key:"isbn",title:"ISBN",width:"130px"},{key:"title",title:"书名"},{key:"author",title:"作者",width:"120px"},{key:"copies",title:"库存",width:"100px"},{key:"status",title:"状态",width:"90px"},{key:"actions",title:"操作",width:"160px"}],b=o([]),f=o(!0),x=o(""),v=o(""),r=o(1),z=o(0),y=o(!1),_=o(!1),h=o(null),V=o(null),C=o(!1),$=o(!1),w=o(""),a=ee({isbn:"",title:"",author:"",publisher:"",publish_date:"",category_name:"",total_copies:1,location:"",description:""}),K=E(()=>Math.ceil(z.value/Ee));te(async()=>{await p()});async function p(){f.value=!0;try{const s=new URLSearchParams;x.value&&s.set("kw",x.value),v.value&&s.set("status",v.value),s.set("page",r.value);const e=await le("/api/books?"+s.toString());b.value=e.results||e.books||[],z.value=e.count||b.value.length}catch(s){N(s.message||"加载失败")}finally{f.value=!1}}function q(s){r.value=s,p()}function F(){Object.assign(a,{isbn:"",title:"",author:"",publisher:"",publish_date:"",category_name:"",total_copies:1,location:"",description:""}),w.value=""}function O(s){h.value=s,Object.assign(a,{isbn:s.isbn||"",title:s.title||"",author:s.author||"",publisher:s.publisher||"",publish_date:s.publish_date||"",category_name:s.category_name||"",total_copies:s.total_copies||1,location:s.location||"",description:s.description||""}),y.value=!0}async function G(){w.value="",C.value=!0;try{const s={...a};s.publish_date||delete s.publish_date,s.category_name||delete s.category_name,h.value?(await I(`/api/books/${h.value.id}`,s),U("更新成功")):(await ie("/api/books",s),U("添加成功")),y.value=!1,h.value=null,F(),await p()}catch(s){w.value=s.message||"操作失败"}finally{C.value=!1}}async function J(s){try{const e=s.status==="on_shelf"?"off_shelf":"on_shelf";await I(`/api/books/${s.id}`,{status:e}),U(e==="on_shelf"?"已上架":"已下架"),await p()}catch(e){N(e.message||"操作失败")}}function L(s){V.value=s,_.value=!0}async function R(){$.value=!0;try{await ue(`/api/books/${V.value.id}`),U("删除成功"),_.value=!1,V.value=null,await p()}catch(s){N(s.message||"删除失败")}finally{$.value=!1}}return(s,e)=>{const X=se("router-link");return g(),k("div",null,[t("div",ye,[e[17]||(e[17]=t("h1",{class:"text-2xl font-semibold text-text-primary"},"图书管理",-1)),t("div",ge,[t("button",{onClick:e[0]||(e[0]=l=>y.value=!0),class:"btn-primary"}," + 新增图书 "),c(X,{to:"/manage/import-export/",class:"btn-secondary"},{default:d(()=>[...e[16]||(e[16]=[S(" 导入/导出 ",-1)])]),_:1})])]),t("div",_e,[t("div",he,[n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>x.value=l),type:"text",placeholder:"搜索书名、作者、ISBN...",class:"w-full pl-12 pr-4 py-2.5 input",onKeyup:ae(p,["enter"])},null,544),[[i,x.value]]),c(P(re),{class:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted","stroke-width":2})]),n(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>v.value=l),class:"input w-40",onChange:p},[...e[18]||(e[18]=[t("option",{value:""},"全部状态",-1),t("option",{value:"on_shelf"},"已上架",-1),t("option",{value:"off_shelf"},"已下架",-1)])],544),[[oe,v.value]]),t("button",{onClick:p,class:"btn-primary"},"搜索")]),c(de,{columns:M,data:b.value,loading:f.value,"row-key":"id"},{isbn:d(({value:l})=>[t("span",we,u(l),1)]),status:d(({row:l})=>[t("span",{class:T(["inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg",l.status==="on_shelf"?"bg-emerald-50 text-emerald-600":"bg-border-light text-text-muted"])},u(l.status==="on_shelf"?"上架":"下架"),3)]),copies:d(({row:l})=>[t("span",ke,u(l.available_copies),1),t("span",Ve," / "+u(l.total_copies),1)]),actions:d(({row:l})=>[t("div",Ce,[t("button",{onClick:j=>O(l),class:"text-claude-600 hover:text-claude-700 text-sm font-medium"}," 编辑 ",8,$e),t("button",{onClick:j=>J(l),class:"text-amber-600 hover:text-amber-700 text-sm font-medium"},u(l.status==="on_shelf"?"下架":"上架"),9,Se),t("button",{onClick:j=>L(l),class:"text-red-500 hover:text-red-600 text-sm font-medium"}," 删除 ",8,Ue)])]),_:1},8,["data","loading"]),t("div",Be,[c(pe,{"current-page":r.value,"total-pages":K.value,onChange:q},null,8,["current-page","total-pages"])]),c(A,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=l=>y.value=l),title:h.value?"编辑图书":"新增图书",size:"lg"},{default:d(()=>[t("form",{onSubmit:ne(G,["prevent"])},[t("div",Me,[t("div",null,[e[19]||(e[19]=t("label",{class:"label"},[S("ISBN "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.isbn=l),type:"text",class:"input",required:""},null,512),[[i,a.isbn]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"label"},[S("书名 "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.title=l),type:"text",class:"input",required:""},null,512),[[i,a.title]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"label"},[S("作者 "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>a.author=l),type:"text",class:"input",required:""},null,512),[[i,a.author]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"label"},"出版社",-1)),n(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.publisher=l),type:"text",class:"input"},null,512),[[i,a.publisher]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"label"},"出版日期",-1)),n(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>a.publish_date=l),type:"date",class:"input"},null,512),[[i,a.publish_date]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"label"},"分类",-1)),n(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>a.category_name=l),type:"text",class:"input",placeholder:"输入分类名称"},null,512),[[i,a.category_name]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"label"},"总库存",-1)),n(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>a.total_copies=l),type:"number",min:"0",class:"input"},null,512),[[i,a.total_copies,void 0,{number:!0}]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"label"},"位置",-1)),n(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>a.location=l),type:"text",class:"input",placeholder:"如 A-01"},null,512),[[i,a.location]])]),t("div",ze,[e[27]||(e[27]=t("label",{class:"label"},"简介",-1)),n(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=l=>a.description=l),rows:"3",class:"input"},null,512),[[i,a.description]])])]),w.value?(g(),k("div",Ne,u(w.value),1)):B("",!0),t("div",je,[t("button",{type:"button",onClick:e[12]||(e[12]=l=>y.value=!1),class:"btn-secondary"},"取消"),t("button",{type:"submit",disabled:C.value,class:"btn-primary"},u(C.value?"保存中...":"保存"),9,De)])],32)]),_:1},8,["modelValue","title"]),c(A,{modelValue:_.value,"onUpdate:modelValue":e[15]||(e[15]=l=>_.value=l),title:"确认删除",size:"sm"},{footer:d(()=>[t("button",{onClick:e[14]||(e[14]=l=>_.value=!1),class:"btn-secondary"},"取消"),t("button",{onClick:R,disabled:$.value,class:"btn-danger"},u($.value?"删除中...":"确认删除"),9,Ae)]),default:d(()=>{var l;return[t("p",Ie,"确定要删除《"+u((l=V.value)==null?void 0:l.title)+"》吗？此操作不可恢复。",1)]}),_:1},8,["modelValue"])])}}};export{qe as default};
