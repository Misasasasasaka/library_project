import{l as M,r,a as n,o as i,b as e,d as m,u as v,t as a,X as j,E as b,n as N,y as C,e as y,w as $,P as F,F as R,j as z,O as B,C as V,h as S,Q as H}from"./index-BneSkAzL.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=M("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=M("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=M("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),A=["accept"],q={key:0},E={class:"mt-2 text-sm text-text-muted"},L={key:1,class:"flex items-center justify-center gap-3"},O={class:"text-text-primary font-medium"},P={__name:"FileUpload",props:{accept:{type:String,default:".csv"},hint:{type:String,default:"支持 CSV 文件"}},emits:["change"],setup(h,{expose:g,emit:p}){const u=p,c=r(null),d=r(!1),o=r(null);function k(){var s;(s=c.value)==null||s.click()}function _(s){var l;const t=(l=s.target.files)==null?void 0:l[0];t&&(o.value=t,u("change",t))}function w(s){var l;d.value=!1;const t=(l=s.dataTransfer.files)==null?void 0:l[0];t&&(o.value=t,u("change",t))}function f(){o.value=null,c.value&&(c.value.value=""),u("change",null)}return g({clearFile:f}),(s,t)=>(i(),n("div",{class:N(["border-2 border-dashed rounded-2xl p-10 text-center transition-all duration-200 cursor-pointer",d.value?"border-claude-400 bg-claude-50":"border-border hover:border-border-dark bg-sidebar"]),onDragover:t[0]||(t[0]=b(l=>d.value=!0,["prevent"])),onDragleave:t[1]||(t[1]=b(l=>d.value=!1,["prevent"])),onDrop:b(w,["prevent"]),onClick:k},[e("input",{ref_key:"inputRef",ref:c,type:"file",accept:h.accept,class:"hidden",onChange:_},null,40,A),o.value?(i(),n("div",L,[m(v(T),{class:"w-10 h-10 text-claude-500","stroke-width":1.5}),e("span",O,a(o.value.name),1),e("button",{onClick:b(f,["stop"]),class:"text-text-muted hover:text-red-500 transition-colors"},[m(v(j),{class:"w-5 h-5","stroke-width":2})])])):(i(),n("div",q,[m(v(I),{class:"w-14 h-14 mx-auto text-text-light","stroke-width":1.5}),t[2]||(t[2]=e("p",{class:"mt-4 text-text-secondary font-medium"},"拖拽文件到此处，或点击上传",-1)),e("p",E,a(h.hint),1)]))],34))}},Q={class:"grid grid-cols-2 gap-8"},X={class:"bg-white rounded-2xl border border-border p-8"},G={class:"space-y-3"},J={class:"bg-white rounded-2xl border border-border p-8"},K={class:"mt-5 space-y-3"},W={class:"flex items-center gap-3 text-sm text-text-secondary cursor-pointer"},Y={class:"flex items-center gap-3 text-sm text-text-secondary cursor-pointer"},Z=["disabled"],tt={key:0,class:"mt-8 bg-white rounded-2xl border border-border p-8"},et={class:"grid grid-cols-4 gap-4 mb-6"},st={class:"text-center p-5 bg-emerald-50 rounded-xl"},ot={class:"text-3xl font-semibold text-emerald-600"},lt={class:"text-center p-5 bg-claude-50 rounded-xl"},at={class:"text-3xl font-semibold text-claude-600"},dt={class:"text-center p-5 bg-sidebar rounded-xl"},rt={class:"text-3xl font-semibold text-text-muted"},nt={class:"text-center p-5 bg-red-50 rounded-xl"},it={class:"text-3xl font-semibold text-red-500"},ut={key:0,class:"p-4 bg-amber-50 text-amber-700 text-sm rounded-xl mb-6"},ct={key:1},xt={class:"max-h-60 overflow-auto border border-border rounded-xl"},pt={class:"w-full text-sm"},mt={class:"divide-y divide-border"},vt={class:"px-4 py-3"},ft={class:"px-4 py-3 font-mono text-xs"},bt={class:"px-4 py-3 text-red-600"},ht={__name:"App",setup(h){const g=r(null),p=r(null),u=r(!0),c=r(!1),d=r(!1),o=r(null);function k(s){p.value=s,o.value=null}async function _(){try{await B("/api/admin/books/export","books.csv"),V("导出成功")}catch(s){S(s.message||"导出失败")}}async function w(){try{await B("/api/admin/borrows/export","borrows.csv"),V("导出成功")}catch(s){S(s.message||"导出失败")}}async function f(){if(p.value){d.value=!0,o.value=null;try{const s=new FormData;s.append("file",p.value);const t={};u.value&&(t.dry_run="1"),c.value&&(t.atomic="1");const l=await H("/api/admin/books/import",s,t);o.value=l,l.applied&&V(`导入成功：新增 ${l.created}，更新 ${l.updated}`)}catch(s){S(s.message||"导入失败")}finally{d.value=!1}}}return(s,t)=>{var l,D;return i(),n("div",null,[t[17]||(t[17]=e("h1",{class:"text-2xl font-semibold text-text-primary mb-8"},"导入 / 导出",-1)),e("div",Q,[e("section",X,[t[4]||(t[4]=e("h2",{class:"text-lg font-medium text-text-primary mb-4"},"导出数据",-1)),t[5]||(t[5]=e("p",{class:"text-sm text-text-muted mb-6"},"将数据导出为 CSV 文件，可用于备份或在其他系统中使用。",-1)),e("div",G,[e("button",{onClick:_,class:"w-full btn-secondary flex items-center justify-center gap-2"},[m(v(U),{class:"w-5 h-5","stroke-width":1.75}),t[2]||(t[2]=y(" 导出图书 CSV ",-1))]),e("button",{onClick:w,class:"w-full btn-secondary flex items-center justify-center gap-2"},[m(v(U),{class:"w-5 h-5","stroke-width":1.75}),t[3]||(t[3]=y(" 导出借阅记录 CSV ",-1))])])]),e("section",J,[t[8]||(t[8]=e("h2",{class:"text-lg font-medium text-text-primary mb-4"},"导入数据",-1)),t[9]||(t[9]=e("p",{class:"text-sm text-text-muted mb-6"},"上传 CSV 文件批量导入图书数据。支持新增和更新（按 ISBN 匹配）。",-1)),m(P,{ref_key:"fileUploadRef",ref:g,accept:".csv",hint:"支持 UTF-8 编码的 CSV 文件",onChange:k},null,512),e("div",K,[e("label",W,[$(e("input",{"onUpdate:modelValue":t[0]||(t[0]=x=>u.value=x),type:"checkbox",class:"rounded border-border text-claude-500 focus:ring-claude-400"},null,512),[[F,u.value]]),t[6]||(t[6]=y(" 试运行（仅预览，不写入数据库） ",-1))]),e("label",Y,[$(e("input",{"onUpdate:modelValue":t[1]||(t[1]=x=>c.value=x),type:"checkbox",class:"rounded border-border text-claude-500 focus:ring-claude-400"},null,512),[[F,c.value]]),t[7]||(t[7]=y(" 原子导入（任一行失败则全部回滚） ",-1))])]),e("button",{onClick:f,disabled:!p.value||d.value,class:"mt-5 w-full btn-primary"},a(d.value?"导入中...":"开始导入"),9,Z)])]),o.value?(i(),n("section",tt,[t[16]||(t[16]=e("h2",{class:"text-lg font-medium text-text-primary mb-6"},"导入结果",-1)),e("div",et,[e("div",st,[e("div",ot,a(o.value.created),1),t[10]||(t[10]=e("div",{class:"text-sm text-text-muted mt-1"},"新增",-1))]),e("div",lt,[e("div",at,a(o.value.updated),1),t[11]||(t[11]=e("div",{class:"text-sm text-text-muted mt-1"},"更新",-1))]),e("div",dt,[e("div",rt,a(o.value.skipped),1),t[12]||(t[12]=e("div",{class:"text-sm text-text-muted mt-1"},"跳过",-1))]),e("div",nt,[e("div",it,a(((l=o.value.errors)==null?void 0:l.length)||0),1),t[13]||(t[13]=e("div",{class:"text-sm text-text-muted mt-1"},"错误",-1))])]),o.value.applied===!1?(i(),n("div",ut,a(u.value?"试运行模式：数据未写入数据库":"原子导入失败：所有更改已回滚"),1)):C("",!0),(D=o.value.errors)!=null&&D.length?(i(),n("div",ct,[t[15]||(t[15]=e("h3",{class:"text-sm font-medium text-text-primary mb-3"},"错误详情",-1)),e("div",xt,[e("table",pt,[t[14]||(t[14]=e("thead",{class:"bg-sidebar sticky top-0"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-text-secondary"},"行号"),e("th",{class:"px-4 py-3 text-left text-text-secondary"},"ISBN"),e("th",{class:"px-4 py-3 text-left text-text-secondary"},"错误信息")])],-1)),e("tbody",mt,[(i(!0),n(R,null,z(o.value.errors,x=>(i(),n("tr",{key:x.row,class:"hover:bg-sidebar"},[e("td",vt,a(x.row),1),e("td",ft,a(x.isbn),1),e("td",bt,a(x.message),1)]))),128))])])])])):C("",!0)])):C("",!0)])}}};export{ht as default};
