import{g as r,h as k,i as w,j as y,d,b as t,t as a,F as V,m as C,y as S,k as f,f as _,V as g,A as B,C as v,o}from"./index-BZEQeExx.js";const D={class:"bg-white rounded-2xl border border-border p-8 mb-8"},F={class:"flex items-center justify-between mb-6"},N=["disabled"],P={key:0,class:"text-center py-12 text-text-muted"},R={key:1,class:"text-center py-12 text-text-muted"},U={key:2,class:"overflow-x-auto"},j={class:"w-full"},A={class:"divide-y divide-border"},L={class:"px-5 py-4 text-sm font-medium text-text-primary"},M={class:"px-5 py-4 text-sm text-text-muted"},E={class:"px-5 py-4 text-sm"},T={class:"text-red-500 font-semibold"},$={class:"px-5 py-4"},q={key:0,class:"text-text-light"},z={key:1,class:"text-emerald-500 font-medium"},G={key:2,class:"text-text-muted"},H={class:"bg-white rounded-2xl border border-border p-8"},I={class:"space-y-4 mb-8"},J={class:"flex items-center gap-3 text-sm text-text-secondary cursor-pointer"},K={class:"flex items-center gap-3 text-sm text-text-secondary cursor-pointer"},O=["disabled"],Q={key:0,class:"mt-8 p-6 bg-sidebar rounded-xl"},W={class:"grid grid-cols-4 gap-4 text-center"},X={class:"text-2xl font-semibold text-emerald-600"},Y={class:"text-2xl font-semibold text-text-muted"},Z={class:"text-2xl font-semibold text-text-muted"},tt={class:"text-2xl font-semibold text-red-500"},lt={__name:"App",setup(et){const x=r(null),i=r(!0),u=r(!1),m=r(!1),c=r(!1),n=r(null);k(async()=>{await p()});async function p(){i.value=!0;try{const s=await w("/api/admin/overdue/preview");x.value=s}catch(s){y(s.message||"加载失败")}finally{i.value=!1}}async function h(){c.value=!0,n.value=null;try{const s=new URLSearchParams;u.value&&s.set("dry_run","1"),m.value&&s.set("force","1");const e=await B("/api/admin/overdue/send?"+s.toString());n.value=e,e.sent>0?v(`成功发送 ${e.sent} 封邮件`):u.value?v("试运行完成"):v("没有需要发送的邮件"),await p()}catch(s){y(s.message||"发送失败")}finally{c.value=!1}}return(s,e)=>{var b;return o(),d("div",null,[e[12]||(e[12]=t("h1",{class:"text-2xl font-semibold text-text-primary mb-8"},"逾期通知",-1)),t("section",D,[t("div",F,[e[2]||(e[2]=t("h2",{class:"text-lg font-medium text-text-primary"},"逾期用户预览",-1)),t("button",{onClick:p,disabled:i.value,class:"btn-secondary text-sm"},a(i.value?"刷新中...":"刷新"),9,N)]),i.value?(o(),d("div",P," 加载中... ")):!x.value||((b=x.value.results)==null?void 0:b.length)===0?(o(),d("div",R," 暂无逾期用户 ")):(o(),d("div",U,[t("table",j,[e[3]||(e[3]=t("thead",{class:"bg-sidebar border-b border-border"},[t("tr",null,[t("th",{class:"px-5 py-4 text-left text-sm font-medium text-text-secondary"},"用户"),t("th",{class:"px-5 py-4 text-left text-sm font-medium text-text-secondary"},"邮箱"),t("th",{class:"px-5 py-4 text-left text-sm font-medium text-text-secondary"},"逾期数量"),t("th",{class:"px-5 py-4 text-left text-sm font-medium text-text-secondary"},"今日已发")])],-1)),t("tbody",A,[(o(!0),d(V,null,C(x.value.results,l=>(o(),d("tr",{key:l.user.id,class:"hover:bg-sidebar transition-colors"},[t("td",L,a(l.user.username),1),t("td",M,a(l.user.mail||"(无邮箱)"),1),t("td",E,[t("span",T,a(l.items.length)+" 本",1)]),t("td",$,[l.user.mail?l.already_sent?(o(),d("span",z,"已发")):(o(),d("span",G,"未发")):(o(),d("span",q,"-"))])]))),128))])])]))]),t("section",H,[e[11]||(e[11]=t("h2",{class:"text-lg font-medium text-text-primary mb-6"},"发送选项",-1)),t("div",I,[t("label",J,[f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),type:"checkbox",class:"rounded border-border text-claude-500 focus:ring-claude-400"},null,512),[[g,u.value]]),e[4]||(e[4]=_(" 试运行（仅预览，不发送邮件） ",-1))]),t("label",K,[f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),type:"checkbox",class:"rounded border-border text-claude-500 focus:ring-claude-400"},null,512),[[g,m.value]]),e[5]||(e[5]=_(" 强制发送（忽略今日已发送） ",-1))])]),t("button",{onClick:h,disabled:c.value,class:"btn-primary"},a(c.value?"发送中...":"发送逾期通知邮件"),9,O),n.value?(o(),d("div",Q,[e[10]||(e[10]=t("h3",{class:"font-medium text-text-primary mb-4"},"发送结果",-1)),t("div",W,[t("div",null,[t("div",X,a(n.value.sent),1),e[6]||(e[6]=t("div",{class:"text-xs text-text-muted mt-1"},"已发送",-1))]),t("div",null,[t("div",Y,a(n.value.skipped_no_mail),1),e[7]||(e[7]=t("div",{class:"text-xs text-text-muted mt-1"},"无邮箱",-1))]),t("div",null,[t("div",Z,a(n.value.skipped_already_sent),1),e[8]||(e[8]=t("div",{class:"text-xs text-text-muted mt-1"},"已发过",-1))]),t("div",null,[t("div",tt,a(n.value.failed),1),e[9]||(e[9]=t("div",{class:"text-xs text-text-muted mt-1"},"失败",-1))])])])):S("",!0)])])}}};export{lt as default};
