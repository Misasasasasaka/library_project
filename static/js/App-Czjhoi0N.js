import{c as v,d as n,o as r,b as e,e as N,u as j,B as F,f as S,y as p,t as c,g as k,h as V,K as Y,q as B,i as A,j as $,F as D,m as M,a as q,A as R,C}from"./index-BZEQeExx.js";const H={class:"bg-white rounded-2xl border border-border p-4 hover:shadow-sm transition-shadow"},L={class:"flex gap-4"},O={class:"w-20 h-28 bg-sidebar rounded-xl flex-shrink-0 overflow-hidden"},U=["src","alt"],E={key:1,class:"w-full h-full flex items-center justify-center text-text-light"},I={class:"flex-1 min-w-0"},K={class:"font-medium text-text-primary truncate"},P={key:0,class:"ml-2 font-mono text-xs bg-sidebar px-2 py-0.5 rounded"},T={class:"text-sm text-text-muted mt-1"},z={class:"flex items-center gap-2 mt-2"},G={key:0,class:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg bg-red-50 text-red-600"},J={key:1,class:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg bg-amber-50 text-amber-600"},Q={key:2,class:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg bg-claude-50 text-claude-600"},W={class:"flex gap-2 mt-3"},X=["disabled"],Z=["disabled"],tt={__name:"BorrowCard",props:{borrow:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:["renew","return"],setup(o){const x=o;function m(u){if(!u)return"-";const d=new Date(u);return`${d.getMonth()+1}-${d.getDate()}`}const i=v(()=>{if(!x.borrow.due_date)return 0;const u=new Date(x.borrow.due_date),d=new Date;return d.setHours(0,0,0,0),u.setHours(0,0,0,0),Math.ceil((u-d)/(1e3*60*60*24))}),y=v(()=>Math.abs(i.value));return(u,d)=>{var b,f,g,h;return r(),n("div",H,[e("div",L,[e("div",O,[(b=o.borrow.book)!=null&&b.cover_url?(r(),n("img",{key:0,src:o.borrow.book.cover_url,alt:(f=o.borrow.book)==null?void 0:f.title,class:"w-full h-full object-cover"},null,8,U)):(r(),n("div",E,[N(j(F),{class:"w-8 h-8","stroke-width":1})]))]),e("div",I,[e("h4",K,[S(c((g=o.borrow.book)==null?void 0:g.title)+" ",1),(h=o.borrow.copy)!=null&&h.code?(r(),n("span",P,c(o.borrow.copy.code),1)):p("",!0)]),e("p",T," 借阅: "+c(m(o.borrow.borrow_date))+" · 应还: "+c(m(o.borrow.due_date)),1),e("div",z,[o.borrow.is_overdue?(r(),n("span",G," 逾期 "+c(y.value)+" 天 ",1)):i.value<=3&&i.value>0?(r(),n("span",J," 剩余 "+c(i.value)+" 天 ",1)):i.value>0?(r(),n("span",Q," 借阅中 ")):p("",!0)]),e("div",W,[!o.borrow.return_date&&!o.borrow.is_overdue?(r(),n("button",{key:0,onClick:d[0]||(d[0]=_=>u.$emit("renew",o.borrow.id)),class:"px-3 py-1.5 text-sm border border-border text-text-secondary rounded-lg hover:bg-sidebar transition-colors",disabled:o.loading}," 续借 ",8,X)):p("",!0),o.borrow.return_date?p("",!0):(r(),n("button",{key:1,onClick:d[1]||(d[1]=_=>u.$emit("return",o.borrow.id)),class:"px-3 py-1.5 text-sm bg-claude-500 text-white rounded-lg hover:bg-claude-600 transition-colors",disabled:o.loading},c(o.borrow.is_overdue?"立即归还":"归还"),9,Z))])])])])}}},et={key:0,class:"text-center py-16 text-text-muted"},st={class:"mb-10"},rt={key:0,class:"text-center py-12 text-text-muted bg-white rounded-2xl border border-border"},ot={key:1,class:"space-y-4"},nt={key:0,class:"text-center py-12 text-text-muted bg-white rounded-2xl border border-border"},at={key:1,class:"bg-white rounded-2xl border border-border overflow-hidden"},dt={class:"w-full"},lt={class:"divide-y divide-border"},it={class:"px-6 py-4 text-sm text-text-primary"},ut={class:"px-6 py-4 text-sm text-text-muted font-mono"},ct={class:"px-6 py-4 text-sm text-text-muted"},xt={class:"px-6 py-4 text-sm text-text-muted"},bt={__name:"App",setup(o){const x=k([]),m=k(!0),i=k(null),y=v(()=>x.value.filter(s=>!s.return_date)),u=v(()=>x.value.filter(s=>s.return_date));V(async()=>{await d()});async function d(){var s;m.value=!0;try{const t=new URLSearchParams;Y()&&((s=B.value)==null?void 0:s.id)!=null&&t.set("user_id",String(B.value.id));const a="/api/borrows"+(t.toString()?`?${t.toString()}`:""),l=await A(a);x.value=l.results||l.borrows||[]}catch(t){$(t.message||"加载借阅记录失败")}finally{m.value=!1}}function b(s){if(!s)return"-";const t=new Date(s);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function f(s){const[t,a,l]=String(s||"").split("-").map(Number);return!t||!a||!l?null:new Date(t,a-1,l)}function g(s){return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}async function h(s){i.value=s;try{const t=x.value.find(w=>w.id===s),a=f(t==null?void 0:t.due_date)||new Date,l=new Date(a);l.setDate(l.getDate()+14),await R(`/api/borrows/${s}/renew`,{due_date:g(l)}),C("续借成功！"),await d()}catch(t){$(t.message||"续借失败")}finally{i.value=null}}async function _(s){i.value=s;try{await R(`/api/borrows/${s}/return`),C("归还成功！"),await d()}catch(t){$(t.message||"归还失败")}finally{i.value=null}}return(s,t)=>(r(),n("div",null,[t[4]||(t[4]=e("h1",{class:"text-2xl font-semibold text-text-primary mb-8"},"我的借阅",-1)),m.value?(r(),n("div",et," 加载中... ")):(r(),n(D,{key:1},[e("section",st,[t[0]||(t[0]=e("h2",{class:"text-lg font-medium text-text-primary mb-4 flex items-center"},[e("span",{class:"w-1 h-5 bg-claude-500 rounded mr-3"}),S(" 当前借阅 ")],-1)),y.value.length===0?(r(),n("div",rt," 暂无借阅记录 ")):(r(),n("div",ot,[(r(!0),n(D,null,M(y.value,a=>(r(),q(tt,{key:a.id,borrow:a,loading:i.value===a.id,onRenew:h,onReturn:_},null,8,["borrow","loading"]))),128))]))]),e("section",null,[t[3]||(t[3]=e("h2",{class:"text-lg font-medium text-text-primary mb-4 flex items-center"},[e("span",{class:"w-1 h-5 bg-text-light rounded mr-3"}),S(" 历史记录 ")],-1)),u.value.length===0?(r(),n("div",nt," 暂无历史记录 ")):(r(),n("div",at,[e("table",dt,[t[2]||(t[2]=e("thead",{class:"bg-sidebar border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"书名"),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"副本"),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"借阅日期"),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"归还日期"),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"状态")])],-1)),e("tbody",lt,[(r(!0),n(D,null,M(u.value,a=>{var l,w;return r(),n("tr",{key:a.id,class:"hover:bg-sidebar transition-colors"},[e("td",it,c((l=a.book)==null?void 0:l.title),1),e("td",ut,c(((w=a.copy)==null?void 0:w.code)||"-"),1),e("td",ct,c(b(a.borrow_date)),1),e("td",xt,c(b(a.return_date)),1),t[1]||(t[1]=e("td",{class:"px-6 py-4"},[e("span",{class:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg bg-border-light text-text-muted"}," 已归还 ")],-1))])}),128))])])]))])],64))]))}};export{bt as default};
