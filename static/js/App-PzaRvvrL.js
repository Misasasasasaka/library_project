import{c as v,r as z,a as M,o as a,w as D,b as s,d as r,e as p,u as y,B as N,t as w,n as B,f as j,g as c,h as F,i as I,j as O,k as U,v as q,l as G,F as P,m as L,L as R}from"./index-BgujHqiP.js";import{S as Z,_ as H}from"./Pagination-BswjxdYU.js";const J={class:"aspect-[3/4] bg-sidebar relative"},Q=["src","alt"],W={key:1,class:"w-full h-full flex items-center justify-center text-text-light"},X={class:"p-4"},Y=["title"],ee={class:"text-sm text-text-muted truncate mt-1"},te={class:"mt-3"},se={__name:"BookCard",props:{book:{type:Object,required:!0}},setup(o){const l=o,u=v(()=>l.book.status==="on_shelf"&&l.book.available_copies>0),m=v(()=>l.book.status==="off_shelf"?"已下架":l.book.available_copies===0?"已借完":"可借阅"),h=v(()=>u.value?"bg-emerald-50 text-emerald-600":"bg-border-light text-text-muted"),f=v(()=>u.value?"bg-emerald-500":"bg-text-muted");return(b,d)=>{const k=z("router-link");return a(),M(k,{to:{name:"book-detail",params:{id:o.book.id}},class:"block bg-white rounded-2xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden border border-border hover:-translate-y-0.5"},{default:D(()=>[s("div",J,[o.book.cover_url?(a(),r("img",{key:0,src:o.book.cover_url,alt:o.book.title,class:"w-full h-full object-cover"},null,8,Q)):(a(),r("div",W,[p(y(N),{class:"w-16 h-16","stroke-width":1})]))]),s("div",X,[s("h3",{class:"font-medium text-text-primary truncate",title:o.book.title},w(o.book.title),9,Y),s("p",ee,w(o.book.author),1),s("div",te,[s("span",{class:B(["inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg",h.value])},[s("span",{class:B(["w-1.5 h-1.5 rounded-full mr-1.5",f.value])},null,2),j(" "+w(m.value),1)],2)])])]),_:1},8,["to"])}}},ae={class:"mb-8"},oe={class:"flex items-center gap-4"},le={class:"flex-1 relative"},ne={class:"mb-8 flex flex-wrap gap-2"},re=["onClick"],ie={key:0,class:"text-center py-16 text-text-muted"},ce={key:1,class:"text-center py-16 text-text-muted"},ue={key:2,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"},de={class:"mt-10"},C=20,he={__name:"App",setup(o){const l=c(""),u=c(null),m=c([]),h=c(!1),f=c([{id:null,name:"全部"}]),b=c(!0),d=c(1),k=c(0),E=v(()=>Math.ceil(k.value/C)),V=v(()=>{if(h.value)return m.value;const e=(d.value-1)*C;return m.value.slice(e,e+C)});F(async()=>{await _()});async function _(){b.value=!0;try{const e=new URLSearchParams;l.value&&e.set("kw",l.value),u.value&&e.set("category",u.value),e.set("page",d.value);const i="/api/books"+(e.toString()?"?"+e.toString():""),t=await I(i),g=t.results||t.books||[];m.value=g,k.value=t.count||g.length,h.value=!!(t.count&&t.count>g.length);const $=new Map;g.forEach(x=>{const n=x.category;(n==null?void 0:n.id)!=null&&$.set(n.id,n.name)});const T=Array.from($,([x,n])=>({id:x,name:n})).sort((x,n)=>String(x.name).localeCompare(String(n.name),"zh-CN"));f.value=[{id:null,name:"全部"},...T]}catch(e){O(e.message||"加载图书失败")}finally{b.value=!1}}function S(){d.value=1,_()}function A(e){u.value=e,d.value=1,_()}function K(e){d.value=e,h.value&&_()}return(e,i)=>(a(),r("div",null,[s("div",ae,[s("div",oe,[s("div",le,[U(s("input",{"onUpdate:modelValue":i[0]||(i[0]=t=>l.value=t),type:"text",placeholder:"搜索书名、作者、ISBN...",class:"w-full pl-12 pr-4 py-3 input",onKeyup:G(S,["enter"])},null,544),[[q,l.value]]),p(y(Z),{class:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted","stroke-width":2})]),s("button",{onClick:S,class:"btn-primary px-6 py-3"}," 搜索 ")])]),s("div",ne,[(a(!0),r(P,null,L(f.value,t=>(a(),r("button",{key:t.id??"all",onClick:g=>A(t.id),class:B(["px-4 py-2 rounded-xl text-sm font-medium transition-all duration-200",u.value===t.id?"bg-claude-500 text-white shadow-sm":"bg-white text-text-secondary border border-border hover:border-claude-400 hover:text-claude-600"])},w(t.name),11,re))),128))]),b.value?(a(),r("div",ie,[p(y(R),{class:"animate-spin h-10 w-10 mx-auto mb-4 text-claude-500","stroke-width":2}),i[1]||(i[1]=j(" 加载中... ",-1))])):m.value.length===0?(a(),r("div",ce,[p(y(N),{class:"w-20 h-20 mx-auto mb-4 text-text-light","stroke-width":1}),i[2]||(i[2]=s("p",{class:"text-lg"},"暂无图书",-1))])):(a(),r("div",ue,[(a(!0),r(P,null,L(V.value,t=>(a(),M(se,{key:t.id,book:t},null,8,["book"]))),128))])),s("div",de,[p(H,{"current-page":d.value,"total-pages":E.value,onChange:K},null,8,["current-page","total-pages"])])]))}};export{he as default};
