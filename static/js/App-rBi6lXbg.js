import{r as n,c as V,f as M,g as P,h as y,a as $,b as e,d as f,w,v as B,i as K,u as E,K as N,s as r,O as T,C as U,o as A,n as F,t as o,e as g}from"./index-BneSkAzL.js";import{_ as I}from"./DataTable-B5qw0pmj.js";import{S as j,_ as z}from"./Pagination-BWsnICMh.js";const G={class:"flex items-center gap-4 mb-6"},L={class:"flex-1 relative"},O={class:"font-medium text-text-primary"},R={class:"text-xs text-text-muted"},Y={class:"font-medium text-text-primary"},Z={class:"text-xs text-text-muted font-mono"},q={class:"mt-8"},H=20,tt={__name:"App",setup(J){const h=[{key:"id",title:"ID",width:"60px"},{key:"user",title:"用户"},{key:"book",title:"图书"},{key:"borrow_date",title:"借阅日期",width:"110px"},{key:"due_date",title:"应还日期",width:"110px"},{key:"return_date",title:"归还日期",width:"110px"},{key:"status",title:"状态",width:"90px"}],p=n([]),m=n(!0),d=n(""),c=n(""),v=n(1),_=n(0),b=V(()=>Math.ceil(_.value/H));M(async()=>{await l()});async function l(){m.value=!0;try{const t=new URLSearchParams;d.value&&t.set("kw",d.value),c.value&&t.set("status",c.value),t.set("page",v.value);const s=await P("/api/borrows?"+t.toString());p.value=s.borrows||[],_.value=s.count||p.value.length}catch(t){y(t.message||"加载失败")}finally{m.value=!1}}function k(t){v.value=t,l()}function x(t){if(!t)return"-";const s=new Date(t);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}function S(t){return t.return_date?"已归还":t.is_overdue?"逾期":"借阅中"}function C(t){return t.return_date?"bg-border-light text-text-muted":t.is_overdue?"bg-red-50 text-red-600":"bg-claude-50 text-claude-600"}async function D(){try{await T("/api/admin/borrows/export","borrows.csv"),U("导出成功")}catch(t){y(t.message||"导出失败")}}return(t,s)=>(A(),$("div",null,[e("div",{class:"flex items-center justify-between mb-8"},[s[2]||(s[2]=e("h1",{class:"text-2xl font-semibold text-text-primary"},"借阅记录",-1)),e("button",{onClick:D,class:"btn-secondary"}," 导出 CSV ")]),e("div",G,[e("div",L,[w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>d.value=a),type:"text",placeholder:"搜索用户名、书名...",class:"w-full pl-12 pr-4 py-2.5 input",onKeyup:K(l,["enter"])},null,544),[[B,d.value]]),f(E(j),{class:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted","stroke-width":2})]),w(e("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>c.value=a),class:"input w-40",onChange:l},[...s[3]||(s[3]=[e("option",{value:""},"全部状态",-1),e("option",{value:"borrowed"},"借阅中",-1),e("option",{value:"overdue"},"逾期",-1),e("option",{value:"returned"},"已归还",-1)])],544),[[N,c.value]]),e("button",{onClick:l,class:"btn-primary"},"搜索")]),f(I,{columns:h,data:p.value,loading:m.value,"row-key":"id"},{user:r(({row:a})=>{var i,u;return[e("div",null,[e("div",O,o((i=a.user)==null?void 0:i.username),1),e("div",R,o(((u=a.user)==null?void 0:u.mail)||"-"),1)])]}),book:r(({row:a})=>{var i,u;return[e("div",null,[e("div",Y,o((i=a.book)==null?void 0:i.title),1),e("div",Z,o((u=a.book)==null?void 0:u.isbn),1)])]}),borrow_date:r(({value:a})=>[g(o(x(a)),1)]),due_date:r(({value:a})=>[g(o(x(a)),1)]),return_date:r(({value:a})=>[g(o(a?x(a):"-"),1)]),status:r(({row:a})=>[e("span",{class:F(["inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg",C(a)])},o(S(a)),3)]),_:1},8,["data","loading"]),e("div",q,[f(z,{"current-page":v.value,"total-pages":b.value,onChange:k},null,8,["current-page","total-pages"])])]))}};export{tt as default};
