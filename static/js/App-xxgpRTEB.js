import{c as h,a as o,o as s,b as e,d as C,u as M,B as R,t as i,y as w,r as g,f as j,g as N,h as v,F as p,e as k,j as $,k as V,A as B,C as D}from"./index-BneSkAzL.js";const F={class:"bg-white rounded-2xl border border-border p-4 hover:shadow-sm transition-shadow"},S={class:"flex gap-4"},A={class:"w-20 h-28 bg-sidebar rounded-xl flex-shrink-0 overflow-hidden"},H=["src","alt"],O={key:1,class:"w-full h-full flex items-center justify-center text-text-light"},q={class:"flex-1 min-w-0"},E={class:"font-medium text-text-primary truncate"},I={class:"text-sm text-text-muted mt-1"},L={class:"flex items-center gap-2 mt-2"},T={key:0,class:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg bg-red-50 text-red-600"},Y={key:1,class:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg bg-amber-50 text-amber-600"},z={key:2,class:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg bg-claude-50 text-claude-600"},G={class:"flex gap-2 mt-3"},J=["disabled"],K=["disabled"],P={__name:"BorrowCard",props:{borrow:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:["renew","return"],setup(n){const c=n;function x(l){if(!l)return"-";const a=new Date(l);return`${a.getMonth()+1}-${a.getDate()}`}const d=h(()=>{if(!c.borrow.due_date)return 0;const l=new Date(c.borrow.due_date),a=new Date;return a.setHours(0,0,0,0),l.setHours(0,0,0,0),Math.ceil((l-a)/(1e3*60*60*24))}),b=h(()=>Math.abs(d.value));return(l,a)=>{var m,y,f;return s(),o("div",F,[e("div",S,[e("div",A,[(m=n.borrow.book)!=null&&m.cover_url?(s(),o("img",{key:0,src:n.borrow.book.cover_url,alt:(y=n.borrow.book)==null?void 0:y.title,class:"w-full h-full object-cover"},null,8,H)):(s(),o("div",O,[C(M(R),{class:"w-8 h-8","stroke-width":1})]))]),e("div",q,[e("h4",E,i((f=n.borrow.book)==null?void 0:f.title),1),e("p",I," 借阅: "+i(x(n.borrow.borrow_date))+" · 应还: "+i(x(n.borrow.due_date)),1),e("div",L,[n.borrow.is_overdue?(s(),o("span",T," 逾期 "+i(b.value)+" 天 ",1)):d.value<=3&&d.value>0?(s(),o("span",Y," 剩余 "+i(d.value)+" 天 ",1)):d.value>0?(s(),o("span",z," 借阅中 ")):w("",!0)]),e("div",G,[!n.borrow.return_date&&!n.borrow.is_overdue?(s(),o("button",{key:0,onClick:a[0]||(a[0]=t=>l.$emit("renew",n.borrow.id)),class:"px-3 py-1.5 text-sm border border-border text-text-secondary rounded-lg hover:bg-sidebar transition-colors",disabled:n.loading}," 续借 ",8,J)):w("",!0),n.borrow.return_date?w("",!0):(s(),o("button",{key:1,onClick:a[1]||(a[1]=t=>l.$emit("return",n.borrow.id)),class:"px-3 py-1.5 text-sm bg-claude-500 text-white rounded-lg hover:bg-claude-600 transition-colors",disabled:n.loading},i(n.borrow.is_overdue?"立即归还":"归还"),9,K))])])])])}}},Q={key:0,class:"text-center py-16 text-text-muted"},U={class:"mb-10"},W={key:0,class:"text-center py-12 text-text-muted bg-white rounded-2xl border border-border"},X={key:1,class:"space-y-4"},Z={key:0,class:"text-center py-12 text-text-muted bg-white rounded-2xl border border-border"},ee={key:1,class:"bg-white rounded-2xl border border-border overflow-hidden"},te={class:"w-full"},se={class:"divide-y divide-border"},re={class:"px-6 py-4 text-sm text-text-primary"},oe={class:"px-6 py-4 text-sm text-text-muted"},ne={class:"px-6 py-4 text-sm text-text-muted"},de={__name:"App",setup(n){const c=g([]),x=g(!0),d=g(null),b=h(()=>c.value.filter(t=>!t.return_date)),l=h(()=>c.value.filter(t=>t.return_date));j(async()=>{await a()});async function a(){x.value=!0;try{const t=await N("/api/borrows");c.value=t.borrows||[]}catch(t){v(t.message||"加载借阅记录失败")}finally{x.value=!1}}function m(t){if(!t)return"-";const r=new Date(t);return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`}async function y(t){d.value=t;try{await B(`/api/borrows/${t}/renew`),D("续借成功！"),await a()}catch(r){v(r.message||"续借失败")}finally{d.value=null}}async function f(t){d.value=t;try{await B(`/api/borrows/${t}/return`),D("归还成功！"),await a()}catch(r){v(r.message||"归还失败")}finally{d.value=null}}return(t,r)=>(s(),o("div",null,[r[4]||(r[4]=e("h1",{class:"text-2xl font-semibold text-text-primary mb-8"},"我的借阅",-1)),x.value?(s(),o("div",Q," 加载中... ")):(s(),o(p,{key:1},[e("section",U,[r[0]||(r[0]=e("h2",{class:"text-lg font-medium text-text-primary mb-4 flex items-center"},[e("span",{class:"w-1 h-5 bg-claude-500 rounded mr-3"}),k(" 当前借阅 ")],-1)),b.value.length===0?(s(),o("div",W," 暂无借阅记录 ")):(s(),o("div",X,[(s(!0),o(p,null,$(b.value,u=>(s(),V(P,{key:u.id,borrow:u,loading:d.value===u.id,onRenew:y,onReturn:f},null,8,["borrow","loading"]))),128))]))]),e("section",null,[r[3]||(r[3]=e("h2",{class:"text-lg font-medium text-text-primary mb-4 flex items-center"},[e("span",{class:"w-1 h-5 bg-text-light rounded mr-3"}),k(" 历史记录 ")],-1)),l.value.length===0?(s(),o("div",Z," 暂无历史记录 ")):(s(),o("div",ee,[e("table",te,[r[2]||(r[2]=e("thead",{class:"bg-sidebar border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"书名"),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"借阅日期"),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"归还日期"),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-text-secondary"},"状态")])],-1)),e("tbody",se,[(s(!0),o(p,null,$(l.value,u=>{var _;return s(),o("tr",{key:u.id,class:"hover:bg-sidebar transition-colors"},[e("td",re,i((_=u.book)==null?void 0:_.title),1),e("td",oe,i(m(u.borrow_date)),1),e("td",ne,i(m(u.return_date)),1),r[1]||(r[1]=e("td",{class:"px-6 py-4"},[e("span",{class:"inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg bg-border-light text-text-muted"}," 已归还 ")],-1))])}),128))])])]))])],64))]))}};export{de as default};
